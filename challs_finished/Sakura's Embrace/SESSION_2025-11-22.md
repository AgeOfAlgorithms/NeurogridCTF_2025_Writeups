# Session Findings - 2025-11-22
**Instance:** http://154.57.164.77:31783
**Flag File:** `/8e6c8beb261c8b003eb412a371c486de.txt`
**Status:** ❌ Still Blocked

---

## New Discoveries

### 1. Editor Service API Endpoints

Found a complete editor service API that wasn't in the source code:

**Endpoints:**
- `GET /editor_api/directory?path=<path>` - Returns directory listing (always returns `/app/main_app/` regardless of path parameter)
- `GET /editor_api/file?path=<path>` - Reads file content
- `POST /editor_api/save` - Writes/saves files (JSON: `{"path": "file.txt", "content": "data"}`)
- `/editor` - Frontend editor UI (React-based with Monaco editor)

### 2. Editor Service Details

**Technology Stack:**
- Frontend: React + SocketIO client + Monaco Editor
- Backend: Python Flask service (runs as `editor` user - PID 24)
- Communication: HTTP REST API + SocketIO

**Path Validation Rules:**
```
BLOCKED:
- Paths containing "flag" (case-insensitive)
- Paths outside /app/main_app/
- Path traversal attempts (../)

ALLOWED:
- Absolute paths within /app/main_app/ (e.g., /app/main_app/app.js)
- Relative paths (e.g., app.js)
```

### 3. SocketIO Investigation

- SocketIO server active at `http://154.57.164.77:31783/socket.io/`
- Successfully connected and received `connection_status` event
- Tested 6 different event names (`load_file`, `read_file`, `get_file`, etc.) - **none responded**
- SocketIO doesn't provide file reading capability (or events are named differently)

### 4. Editor UI Features

**Buttons:**
- **Restart** - Restarts the service (resets progress)
- **Verify** - Checks if vulnerability is patched (not helpful for exploitation)
- **View** - Opens application in new window

**Files visible in explorer:**
- `.gitignore`, `app.js`, `data/`, `db.js`, `exploit.py`, `flag_link.txt`, `package.json`, `public/`, `views/`

**`flag_link.txt`:**
- Visible in file explorer
- **Blocked** by path validation when trying to read
- Attempted to read via cat (spawn_sync) - returned empty (permissions issue)

### 5. Save Endpoint Testing

Successfully tested `/editor_api/save`:
```bash
curl -X POST http://154.57.164.77:31783/editor_api/save \
  -H "Content-Type: application/json" \
  -d '{"path":"test.txt","content":"Hello"}'

# Response: {"md5":"...","message":"File saved successfully"}
```

**Limitations:**
- Same path validation as read endpoint
- Can only write to `/app/main_app/`
- Cannot create files with "flag" in the name

---

## Attempted Exploit Techniques

### 1. SocketIO Event Injection
**Method:** Connect to SocketIO and send custom events
**Result:** ❌ Failed - Server doesn't respond to file read events
**Details:** Tested `load_file`, `read_file`, `get_file`, `file_read`, `open_file`, `fetch_file` with various paths

### 2. Spawn_sync File Copy
**Method:** Use expression injection to copy flag to /app/main_app/
**Code:**
```javascript
global.spawn = process.binding("spawn_sync");
global.spawn.spawn({
  file: "/bin/cp",
  args: ["/bin/cp", "/8e6c8beb261c8b003eb412a371c486de.txt", "/app/main_app/copied.txt"]
})
```
**Result:** ❌ Failed - Permission denied (challenger user can't read flag)

### 3. Symlink Creation
**Method:** Create symlink in /app/main_app/ pointing to flag
**Result:** ❌ Failed - Challenger user lacks permissions to create symlink to unreadable file

### 4. Path Encoding Bypasses
**Tested 14 different encoding techniques:**
- Null byte injection (`\x00`)
- Path traversal (`../`)
- Unicode tricks (RTL override, zero-width spaces)
- Case variations
- URL encoding variations
- Wildcards (`*`, `?`)
- Double slashes
- Backslash (Windows-style)
- Hex encoding

**Result:** ❌ All failed - Path validation is robust

---

## Core Problem

**The fundamental issue:**
1. Flag file has permissions: `440 root:editor` (readable only by root and editor group)
2. Challenger user is NOT in the editor group (UID 100, GID 101)
3. Editor service (PID 24) runs as `editor` user and CAN read the flag
4. Editor service has strict path validation preventing flag access
5. No bypass found for path validation

**What we need:**
- Either: Bypass editor service path validation
- Or: Privilege escalation to join editor group
- Or: Alternative vulnerability in the editor service

---

## Files in Challenge

**Readable via Editor API:**
- `app.js` - Main Node.js application (expression injection vulnerability)
- `db.js` - Database module
- `exploit.py` - Demo exploit (not the solution)
- All files in `/app/main_app/` without "flag" in name

**Blocked:**
- `flag_link.txt` - Contains "flag" keyword
- `/8e6c8beb261c8b003eb412a371c486de.txt` - Outside allowed directory
- Any path with "flag" in it
- Any path outside `/app/main_app/`

---

## Next Steps / Recommendations

1. **Deep Python Backend Analysis**
   - The editor service Python code isn't in the downloaded source
   - Need to find and analyze the actual validation logic
   - Possible TOCTOU race condition?
   - Possible SQL injection or command injection in editor backend?

2. **Alternative Attack Vectors**
   - SSRF in editor service?
   - File upload vulnerability?
   - Race condition between save and read?
   - Memory disclosure?

3. **Re-examine Challenge Design**
   - With only 975 points and "Very Easy" difficulty, solution should be simpler
   - Maybe we're overthinking it?
   - Could there be a hint in the UI or documentation we missed?

4. **Community Approach**
   - Check if others have solved it
   - Look for similar CTF challenges
   - Ask for hints on Discord/forums

---

## Time Invested This Session
- Editor API discovery: 45 min
- SocketIO testing: 30 min
- Path bypass attempts: 45 min
- Spawn_sync exploitation: 30 min
- **Total: ~2.5 hours**

**Cumulative time:** ~14.5 hours

---

## Conclusion

This session made significant progress in understanding the editor service architecture, but did not find a working exploit. The path validation appears robust against common bypasses. The core blocker remains: we need the editor service (running as `editor` user) to read the flag, but its path validation prevents access.

**Status:** Challenge remains unsolved - blocked by path validation
